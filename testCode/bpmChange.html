<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>bitmania</title>
  <style>
    .custom-input{width: 50px;}
    body{ font-family: Arial
          ,sans-serif;
          background-color: #999999;
        }
  </style>

</head>
<body>
  <h1>DEMO</h1>
  <label for="txtBpm">bpm:</label>
  <input type="text" id="txtBpm" name="txtBpm" value="60" class="custom-input" >
<input type="button" value="START" onclick="start()" >

  <p id="pTest">----</p>
  <canvas id="cvs" width="300px" height="550px"></canvas>

  <script>
    let startTime;
    let secBaseClick;
    let countClick;
    let countTempo;
    function start() {
      startTime = Date.now();
      secBaseClick = 60/txtBpm.value;     
      countClick = 0;
      countTempo = 0;
      update(); 
    }
    function update(){
      let elaspsedTime = Date.now() - startTime; 
      if(elaspsedTime/1000 > countClick * secBaseClick){
        countTempo++;
        countClick++; 
        console.log(countClick);

        let workTempo = ""
        for(let i=0; i<countTempo; i++){
          workTempo = workTempo + "*"; 
        } 
        console.log(workTempo);
        pTest.textContent = workTempo;
        if(countTempo === 4){
          countTempo = 0;
        }
      }
     requestAnimationFrame(update);
    }
  </script>

</body>

